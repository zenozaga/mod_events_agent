FROM mod_events_agent:latest AS builder

FROM drachtio/drachtio-freeswitch-mrf:latest

RUN apt-get update && apt-get install -y \
    libcjson1 \
    && rm -rf /var/lib/apt/lists/*

COPY --from=builder /usr/local/lib/libnats.so* /usr/local/lib/
COPY --from=builder /usr/local/lib/mod_event_agent.so /usr/local/freeswitch/mod/

RUN ldconfig

COPY autoload_configs/mod_event_agent.conf.xml /usr/local/freeswitch/conf/autoload_configs/

RUN sed -i '/<\/modules>/i \    <load module="mod_event_agent"/>' /usr/local/freeswitch/conf/autoload_configs/modules.conf.xml

EXPOSE 5060/tcp 5060/udp 5080/tcp 5080/udp 8021/tcp
